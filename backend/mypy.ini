[mypy]
# Python version
python_version = 3.11

# Import discovery
files = app/
exclude = (migrations/|__pycache__|\.pyc$|site-packages/)
follow_imports = skip
follow_imports_for_stubs = False

# Strictness settings (gradually enable as we add types)
disallow_untyped_defs = False
check_untyped_defs = False
disallow_any_generics = False
disallow_subclassing_any = False

# Error suppression for third-party libraries
ignore_missing_imports = True
no_strict_optional = True

# Convenience settings
warn_redundant_casts = True
warn_unused_ignores = False
warn_return_any = False

# SQLAlchemy forward references
# Models use string-based forward refs which are valid at runtime
[mypy-app.models.*]
disable_error_code = name-defined

# Third-party libraries without stubs
[mypy-croniter.*]
ignore_missing_imports = True

[mypy-pytz.*]
ignore_missing_imports = True

[mypy-transformers.*]
ignore_missing_imports = True

[mypy-github.*]
ignore_missing_imports = True

# Services with complex third-party dependencies
[mypy-app.services.github_service]
disable_error_code = attr-defined,valid-type

[mypy-app.services.github_async]
disable_error_code = annotation-unchecked

# Repositories using generic types (needs refactoring)
[mypy-app.repositories.base]
disable_error_code = attr-defined

[mypy-app.repositories.*]
disable_error_code = attr-defined

# Integration layer with crypto utils
[mypy-app.integrations.base]
disable_error_code = attr-defined

# Middleware with context variables
[mypy-app.middleware.correlation]
disable_error_code = attr-defined

# MCP server with protocol types
[mypy-app.mcp.server]
disable_error_code = assignment,union-attr

# Parsers with missing optional fields (legacy code)
[mypy-app.services.parsers.*]
disable_error_code = call-arg,var-annotated

# Project analyzer with schema changes
[mypy-app.services.project_analyzer]
disable_error_code = call-arg

# Research orchestrator (complex error handling)
[mypy-app.services.research_agent_orchestrator]
disable_error_code = arg-type,annotation-unchecked

# Repository model (duplicate property definition)
[mypy-app.models.repository]
disable_error_code = no-redef

# Redis service (untyped functions)
[mypy-app.services.redis_service]
disable_error_code = annotation-unchecked

# AI router (untyped functions)
[mypy-app.services.ai_router]
disable_error_code = annotation-unchecked

# External libraries without type stubs
[mypy-toml.*]
ignore_missing_imports = True

# Utils with custom logging adapter
[mypy-app.utils.logging]
disable_error_code = override

# Exporters with type variations
[mypy-app.exporters.*]
disable_error_code = override,var-annotated

# Cache service (bytes vs str typing)
[mypy-app.services.cache_service_optimized]
disable_error_code = var-annotated,assignment

# Ignore transformers library internal errors
[mypy-transformers.models.sam_hq.processing_samhq]
ignore_errors = True

# Routers with Path/str type issues
[mypy-app.routers.projects]
disable_error_code = misc,attr-defined

# Services with schema/call signature issues (gradually fix)
[mypy-app.services.research_service]
disable_error_code = call-arg,var-annotated,arg-type,assignment,misc,attr-defined

[mypy-app.services.repository_service]
disable_error_code = call-arg,arg-type,attr-defined,misc

[mypy-app.services.research_task_service]
disable_error_code = call-arg,var-annotated,attr-defined,arg-type,misc

[mypy-app.services.technology_service]
disable_error_code = call-arg,arg-type,attr-defined

[mypy-app.services.documentation_scraper_service]
disable_error_code = assignment,attr-defined,var-annotated

[mypy-app.services.batch_service]
disable_error_code = var-annotated

[mypy-app.services.knowledgebeast_service]
disable_error_code = assignment,attr-defined,var-annotated,dict-item

[mypy-app.services.schedule_service]
disable_error_code = var-annotated

[mypy-app.services.docling_service]
disable_error_code = assignment,var-annotated

[mypy-app.services.rag_service]
disable_error_code = call-arg

[mypy-app.services.technology_detector]
disable_error_code = var-annotated

# Routers with method signature issues
# arg-type errors fixed in schedule_service.py **updates annotation
# [mypy-app.routers.schedules]
# disable_error_code = arg-type

[mypy-app.routers.jobs]
disable_error_code = annotation-unchecked

# MCP providers with schema issues
[mypy-app.mcp.providers.commandcenter_tools]
disable_error_code = arg-type

# MCP config
[mypy-app.mcp.config]
disable_error_code = annotation-unchecked

# Tasks
[mypy-app.tasks.webhook_tasks]
disable_error_code = arg-type,attr-defined

# Routers
[mypy-app.routers.research_orchestration]
disable_error_code = assignment,attr-defined
